import numpy as np
import pandas as pd
import os

metaFile = "/Users/Shared/wavelets/hilo/samples/HILO_MAIZE55_PARV50_meta.txt"
meta = pd.read_csv(metaFile,sep='\t',header=0)
symPops = meta.loc[meta['symp_allo']=='sympatric']['RI_ACCESSION'].unique().tolist()
symInds = [i.replace(".posterior","") for i in os.listdir("/Users/Shared/wavelets/hilo/local_ancestry/results/ancestry_hmm/HILO_MAIZE55/K2/Ne10000_yesBoot/posterior")]
#symInds = meta.loc[meta['symp_allo']=='sympatric']['ID'].unique().tolist()

#popDf = pd.read_csv("/Users/Shared/wavelets/hilo/samples/population_metadata.csv",header=0)
#symPops = popDf.loc[popDf['symp_allo'] == 'sympatric']['accession'].to_list()
rule all:
	input:
		expand("hmm_anc_interp/{distance}/{ind}.txt",ind=symInds,distance=['genetic','physical']),
		expand("wavelet_results/{popID}.RData",popID=symPops)

rule interpolate_hmm_ancestry:
	input:
		indFile="/Users/Shared/wavelets/hilo/local_ancestry/results/ancestry_hmm/HILO_MAIZE55/K2/Ne10000_yesBoot/posterior/{ind}.posterior",
		recMapFile="/Users/Shared/wavelets/hilo/linkage_map/results/ogut_2015_rmap_v2_to_v4_EXTENDED.txt",
		chrLenFile="/Users/Shared/wavelets/hilo/data/refMaize/Zea_mays.AFPv4.dna.chr.autosome.lengths"
	output:
		genetic="hmm_anc_interp/genetic/{ind}.txt",
		physical="hmm_anc_interp/physical/{ind}.txt"
	shell:
		"""
		Rscript --vanilla interpolate_hmm_ancestry.R {input.indFile} {wildcards.ind} {input.recMapFile} {input.chrLenFile} 'hmm_anc_interp/'
		"""
		# Rscript arguments 1. genotype posteriors probs for individual 2. individual ID 3. rec map file 4. chr length file 5. path for output

rule wavelets:
	input:
		metaFile=metaFile,
	output:
		"wavelet_results/{popID}.RData"
	shell:
		"Rscript --vanilla zea_wavelets.R {input.metaFile} {wildcards.popID} 'hmm_anc_interp/genetic/' {output}" 
		# Rscript arguments 1. metaFile 2. population ID 3. path to individual ancestry files 4. outFile
		
